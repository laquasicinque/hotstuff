"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var KEY_ALIAS_MAP={"+":"plus","-":"subtract",",":"comma"," ":"space","   ":"tab",arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",control:"ctrl",delete:"del"},KEYCODE_ALIAS_MAP=function(){for(var e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"equals",91:"meta",92:"meta",93:"select",106:"multiply",107:"plus",109:"subtract",110:"decimal",111:"divide",144:"numlock",145:"scrolllock",186:";",187:"equals",189:"minus",190:".",191:"/",192:"grave",219:"[",220:"\\",221:"]",222:"'",223:"`"},t=0;t<=9;t++)e[48+t]=String.fromCharCode(48+t),e[96+t]="numpad"+t;for(t=0;t<=11;t++)e[112+t]="f"+(t+1);for(t=65;t<91;t++)e[t]=String.fromCharCode(t).toLowerCase();return e}(),normalizeHotKey=function(e){return KEY_ALIAS_MAP[e]?KEY_ALIAS_MAP[e]:e},HotKeySort=function(e,t){return"ctrl"!==e&&"control"!==e||(e="\0"),"alt"===e&&(e=""),"shift"===e&&(e=""),"ctrl"!==t&&"control"!==t||(t="\0"),"alt"===t&&(t=""),"shift"===t&&(t=""),e>t},parseKeyCode=function(e){return e.toLowerCase().split(/[+-]/)},addKeyListener=function(e,t){return void 0===e._keyListeners[t]&&(e._keyListeners[t]=[]),e._keyListeners[t]},getKeyObject=function(e,t){return void 0===(e=e._keys)[t]&&(e[t]={trigger:!1,event:null}),e[t]};function createFakeEvent(e,t){var n=document.createEventObject?document.createEventObject():document.createEvent("Event");for(var r in n.initEvent&&n.initEvent("keyup",!0,!0),e)try{n[r]=e[r]}catch(e){}t.dispatchEvent?t.dispatchEvent(n):t.fireEvent("onkeyup",n)}var DEFINE=function(e){return function(t,n){return Object.defineProperty(e,t,n)}},HotStuff=function(e){this instanceof HotStuff?this.init(e):new HotStuff(e)};Object.assign(HotStuff.prototype,{constructor:HotStuff,init:function(e){var t,n=this;if(null==e){if(!window)throw new Error("No element found to attach HotStuff to and could not find window object.");e=window}DEFINE(this)("el",{get:function(){return e},readOnly:!0,enumerable:!0}),this._keyListeners={},this._keysActive=[],this._unresolvedKeyUps=[],this._genericKeyListeners=[],e.addEventListener("keydown",this.handleKeyDown.bind(this)),e.addEventListener("keyup",this.handleKeyUp.bind(this)),t=function(){n._unresolvedKeyUps.forEach(function(e){createFakeEvent(e._events[e._events.length-1],n.el),e._events.splice()}),n._genericKeyListeners.forEach(function(e){var t=e._keys;for(var r in t)t.hasOwnProperty(r)&&t[r].trigger&&(createFakeEvent(t[r].event,n.el),t[r].trigger=!1)})},["blur","focus"].forEach(function(e){return window.addEventListener(e,t)})},addListener:function(e,t,n){var r=this;if("string"==typeof e&&(e=[e]),null===e&&(e=[]),e instanceof Function&&(n=t,t=e,e=[]),!(e instanceof Array))throw new Error("Invalid Keys provided");if(null==n&&null==t)throw new Error("No handlers provided");null==t&&(t=function(e){return e}),null==n&&(n=function(e){return e});var i={};if(0===e.length){var o=[];return t=t.bind(this),n=n.bind(this),void this._genericKeyListeners.push({keyDown:function(e){return o.push(e),t(e,i,r._keysActive.slice())},keyUp:function(e){return n(e,i,r._keysActive.slice())},_keys:{},_events:o})}e.forEach(function(e){e=parseKeyCode(e).map(normalizeHotKey).sort(HotKeySort);var o=[],s=[];t=t.bind(r),n=n.bind(r),addKeyListener(r,e.join("+")).push({keyDown:function(e){return s.push(e),o=r._keysActive.slice(),t(e,i,r._keysActive.slice())},keyUp:function(e){return n(e,i,o)},_events:s})})},handleKeyDown:function(e){var t=this,n=(e.which&&e.keyCode?KEYCODE_ALIAS_MAP[e.which||e.keyCode]:e.key).toLowerCase();this._keysActive.includes(n)||(this._keysActive.push(n),this._keysActive.sort(HotKeySort));var r=this._keysActive.map(normalizeHotKey).join("+");null!=this._keyListeners[r]&&this._keyListeners[r].forEach(function(n){!1!==n.keyDown(e)&&(t._unresolvedKeyUps.includes(n)||t._unresolvedKeyUps.push(n))}),this._genericKeyListeners.forEach(function(t){var r=getKeyObject(t,n);r.trigger=!1!==t.keyDown(e),r.event=e})},handleKeyUp:function(e){var t=(e.which&&e.keyCode?KEYCODE_ALIAS_MAP[e.which||e.keyCode]:e.key).toLowerCase();this._keysActive.includes(t)&&(this._keysActive.splice(this._keysActive.indexOf(t),1),this._keysActive.sort(HotKeySort)),this._unresolvedKeyUps.forEach(function(t){return t.keyUp(e)}),this._unresolvedKeyUps.splice(0),this._genericKeyListeners.forEach(function(n){var r=getKeyObject(n,t);!1!==r.trigger&&(n.keyUp(e),r.trigger=!1,r.event=null)})}}),exports.default=HotStuff;
